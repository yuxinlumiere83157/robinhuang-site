---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications } from '../data/cv'
import CvTimeline from '@/components/ui/CvTimeline.astro'
import { certificates } from '@/data/certificates'

import type { Experience, Education, Publication } from '../types/cv'
import List from '@/components/ui/List.astro'
import PublicationsList from '@/components/ui/PublicationsList.astro'

let orderedExperiences: Experience[] = []
let orderedEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (
			presentValues.includes(
				(a['time'] as string)?.split(' - ')[1]?.toLowerCase()
			)
		) {
			// If the date is 'present', it should be the first element
			return -1
		}
		const dateA = new Date((a['time'] as string)?.split(' - ')[1])
		const dateB = new Date((b['time'] as string)?.split(' - ')[1])
		return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
	orderedExperiences = experiences.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (education.length > 0) {
	orderedEducations = education.sort((a, b) => {
		return orderElement(a, b)
	})
}

---

<Layout>
	{
		orderedEducations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Education
				</h2>
				<CvTimeline elements={orderedEducations} colored={true} />
			</section>
		)
	}

	{
		orderedExperiences.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Experiences
				</h2>
				<CvTimeline elements={orderedExperiences} colored={true} />
			</section>
		)
	}

	{
		orderedPublications.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Last publications
				</h2>
				<PublicationsList elements={orderedPublications}/>
			</section>
		)
	}

	{
		skills.length > 0 && (
			<section class='mb-12'>
				<List listTitle='Skills' listItems={skills}/>
			</section>
		)
	}
	{
	certificates.length > 0 && (
		<section class="mb-12">
		<h2 class="text-2xl font-bold mb-6 border-b pb-2">Certificates</h2>

		<ul class="space-y-3">
			{certificates.map((c) => (
			<li class="border rounded-xl p-4">
				<div class="font-semibold">{c.name}</div>
				<div class="text-sm opacity-80">
				{c.issuer}{c.date ? ` Â· ${c.date}` : ''}
				</div>

				{(c.credentialUrl || c.pdfPath) && (
				<div class="mt-2 flex gap-4 text-sm">
					{c.credentialUrl && (
					<a class="link" href={c.credentialUrl} target="_blank" rel="noopener">
						Verify
					</a>
					)}
					{c.pdfPath && (
					<a class="link" href={c.pdfPath} target="_blank" rel="noopener">
						PDF
					</a>
					)}
				</div>
				)}

				{c.highlights?.length > 0 && (
				<ul class="mt-2 list-disc pl-5 text-sm opacity-90">
					{c.highlights.map((h) => (
					<li>{h}</li>
					))}
				</ul>
				)}
			</li>
			))}
		</ul>
		</section>
	)
	}

</Layout>
